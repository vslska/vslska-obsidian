
## Как задать переменные

Объявленная переменная может быть задана тремя способами:
1.  с помощью аргумента командной строки;
2. в файлах определения переменной `.tfvars`;
3. с помощью переменных окружения.

### 1 . Аргументы командной строки

При выполнении команд `terraform plan` и `terraform apply` можно задать переменные с помощью опции `-var`:
```hcl
$ terraform apply -var="image_id=fd8ne6e3etbrr2ve9nlc"
$ terraform apply -var='image_id_list ["fd8ne6e3etbrr2ve9nlc","fd8fsjddp35jvb4e4jo7"]' -var="cores=4"
$ terraform apply -var='subnet_map={"ru-central1-a":"subnet-a","ru-central1-b":"subnet-b"}'
```

Опцию `-var` можно использовать несколько раз для задания нескольких переменных.

### 2. Файлы определения переменных
При использовании множества переменных удобно указать их значения в файле определений переменных с именем файла, заканчивающимся на `.tfvars` или `.tfvars.json`. А затем указать этот файл в командной строке с помощью параметра `-var-file`:
```
$ terraform apply -var-file="testing.tfvars"
```

В файле определения переменных они задаются в виде `<NAME> = <VALUE>` `<ИМЯ> = <ЗНАЧЕНИЕ>`: 
```
image_id = "fd8ne6e3etbrr2ve9nlc"
zone_names = [
  "ru-central1-a",
  "ru-central1-b",
]
```

В файлах, оканчивающихся на `.json`, переменные задаются как JSON-объекты:
```
{
"image_id": "fd8ne6e3etbrr2ve9nlc",
"zone_names": ["ru-central1-a", "ru-central1-b"]
}
```

Terraform также автоматически загружает ряд файлов определений переменных:
- файлы с именами `terraform.tfvars` или `terraform.tfvars.json`;
- любые файлы с именами, оканчивающимися на `.auto.tfvars` или `.auto.tfvars.json`.

### 3. Переменные окружения
Terraform ищет переменные окружения (начинающиеся с `TF_VAR_`), за которым следует имя объявленной переменной.

Это может быть полезно при автоматизации применения Terraform или последовательном выполнении нескольких команд Terraform с одинаковыми переменными.
```
$ export TF_VAR_image_id=fd8ne6e3etbrr2ve9nlc
$ terraform plan
```

## Порядок обработки переменных
Если одной переменной присваивается несколько значений, Terraform использует последнее найденное значение. При этом переопределяются любые предыдущие значения

> [!NOTE] Важно
> Одной переменной нельзя присвоить несколько значений в пределах одного источника.

1. Переменные окружения.

2. Файл `terraform.tfvars`, если он есть.

3. Файл `terraform.tfvars.json`, если он есть.

4. Любые файлы `*.auto.tfvars` или `*.auto.tfvars.json`, обрабатываемые в алфавитном порядке их имён.

5. Любые опции `-var` и `-var-file` в командной строке в порядке их предоставления.

> [!NOTE] Важно
>  Более поздние источники имеют приоритет над более ранними.

![[Pasted image 20250923181048.png]]

> [!NOTE] Важно
> В Terraform переменные объявляются в файле `variables.tf`, где можно задать их значения по умолчанию. Эти значения будут использоваться, если не заданы другие. Чтобы переопределить значения по умолчанию, можно использовать файл `terraform.tfvars`, в котором прописываются конкретные значения для переменных.

