Условные выражения в Terraform используются для создания гибких и адаптируемых конфигураций, которые могут изменяться в зависимости от параметров или условий. Это позволяет автоматизировать развёртывание инфраструктуры, делая её более управляемой и масштабируемой.

**С помощью условных выражений вы можете:**

- **Задавать разные настройки для разных сред** Например, размеры виртуальных машин могут отличаться в зависимости от того, в production-среде они или в тестовой. Можно использовать условные выражения для выбора разных параметров.
- **Создавать ресурсы в зависимости от условий** Если некоторые ресурсы должны создаваться только при определённых условиях, это можно настроить. Например, создавать дополнительные резервные копии баз данных только для production-среды.
- **Настраивать параметры в зависимости от зоны доступности** Вы можете настроить параметры ресурсов в зависимости от региона развёртывания.
- **Устанавливать опциональные настройки безопасности** Вы можете добавить дополнительные слои безопасности, такие как группы безопасности, в зависимости от определённых условий.

Условные выражения играют важную роль в Terraform, позволяя динамически настраивать конфигурации в зависимости от различных условий.

Синтаксис условных выражений в Terraform следующий:
```
condition ? true_value : false_value
```
Если `condition` имеет значение `true`, то результатом выражения будет `true_value`. Если `condition` имеет значение `false`, то результатом будет `false_value`.

Один из примеров применения условий — задание значения по умолчанию для замены недопустимых значений:
```
var.name == "" ? "default-name" : var.name 
```
Если значение переменной `name` — пустая строка, то результатом будет `default-name`, в противном случае будет использовано значение переменной `name`.

Условия можно комбинировать:
```
var.name == "" ? var.default != null? var.default : "default_name" : var.name 
```
В примере выше в случае значения, равного пустой строке, у переменной `name` будет использовано значение переменной `default`. Если же оно не задано, то результатом будет строка `default-name`. Если ни одно из условий не выполнено, будет использовано значение переменной `name`.
#### **Ограничение на использование типа данных**

> [!NOTE] Важно
> Тип данных результатов условного выражения должен быть одинаковым, чтобы Terraform мог определить, какой тип вернёт всё условное выражение.

Если типы данных различаются, Terraform попытается привести результаты к единому типу. Например, следующее выражение при значении переменной `example`, равном `true`, вернёт преобразованное в тип данных **string** значение `12`. Если значение переменной `example` равно `false`, это же выражение вернёт строку `hello`.
```
var.example ? 12 : "hello"
```
Если в качестве результатов условного выражения используются, например, сложные объекты с различающимися атрибутами, Terraform не сможет привести данные к единому типу и вернёт ошибку:
```
Error: Inconsistent conditional result types

The true and false result expressions must have consistent types. The given
expressions are object and object, respectively.
```
В этом случае можно привести схемы сравниваемых объектов к единому виду или отказаться от использования объектов в условии.
