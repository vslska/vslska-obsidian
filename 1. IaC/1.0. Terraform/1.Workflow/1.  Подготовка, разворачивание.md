Write or init ---> Plan ----> Apply

1.  Write or init
Написанеи кода или инициализация из репозитория контроля версий.
Рекомендуется использовать системы контроля версий, в качестве наилучшей практики.` 
2. Plan 
Просмотр изменений, которые производит код. Корректировка кода по необходимости. 
На данном этапе инфраструктура ещё не развернута, здесь можно посмотреть изменения которые мы внесли, проверить на ошибки. Можно вернутсья назад и модифицировать код.
3. Apply 
Финальная оценка изменений и применение кода для реализации инфраструктуры. Опционально `terraform fmt` нужен для приведения кода к каноничному формату и сохранения в Git-репозитории с помощью `git commit` и `git push`. Вы разворачиваете или выполняете код и вносите изменения в среду.
 C помощью опции `-replace` передаётся требование заменить ресурс

### Шаги
##### 1. Написание кода ( пример на ydb)
```hcl
terraform {
  required_providers {
    yandex = {
      source = "yandex-cloud/yandex"
    }
  }
  required_version = ">= 0.13"
}

provider "yandex" {
  zone = "ru-central1-a"
}

resource "yandex_ydb_database_serverless" "this" {
  name        = "test-ydb-serverless"
  location_id = "ru-central1"
}
```
#####  2. Для начала мы выполним инициализацию директории
```
terraform init
```

> [!На этом этапе происходит:]
> - **Инициализация backend для хранения state** State хранит текущее состояние инфраструктуры, управляемой Terraform. Backend определяет, где Terraform хранит state.
> - **Загрузка провайдеров** Провайдер позволяет взаимодействовать с Yandex Cloud.
> - **Загрузка модулей, если они используются** Модули позволяют организовывать и структурировать код Terraform, обеспечивая его повторное использование и управление зависимостями в рамках инфраструктурного проекта.
> 

##### 3.  Планирование инфраструктуры
После написания кода и инициализации директории можно переходить к планированию инфраструктуры. Чтобы отобразить план выполнения кода, запустите команду:
```
terraform plan
```

> [!На этом этапе происходит:]
> - Сравнение конфигурации Terraform с реальной инфраструктурой
> - Отображение плана выполнения

Например, при создании Managed Service for YDB вы увидите такой план выполнения:
```bash
Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # yandex_ydb_database_serverless.this will be created
  + resource "yandex_ydb_database_serverless" "this" {
      + created_at            = (known after apply)
      + database_path         = (known after apply)
      + deletion_protection   = false
      + document_api_endpoint = (known after apply)
      + folder_id             = (known after apply)
      + id                    = (known after apply)
      + location_id           = "ru-central1"
      + name                  = "test-ydb-serverless"
      + sleep_after           = 0
      + status                = (known after apply)
      + tls_enabled           = (known after apply)
      + ydb_api_endpoint      = (known after apply)
      + ydb_full_endpoint     = (known after apply)

      + serverless_database (known after apply)
    }

Plan: 1 to add, 0 to change, 0 to destroy.
```

Указанный план выполнения говорит о том, что будет создан один ресурс с указанными атрибутами.
**Атрибуты в плане могут быть отражены как** `known after apply`**:**
- Если какие-то из атрибутов в коде не указаны. В этом случаем будут использоваться их default-значения.
- Если какие-то из атрибутов неизвестны на момент планирования, например `id`, `created_at`.
##### Применение изменений
Когда план выполнения будет отображать желаемые результаты, можно применить код и создать реальную инфраструктуру. В этом поможет команда:
```bash
$ terraform apply
```

В результате её выполнения будет отображён финальный план изменений и запрошено подтверждение на его применение:
```bash
...

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value:

```

> [!На этом этапе происходит:]
> - Сравнение конфигурации Terraform с реальной инфраструктурой
> - Отображение плана выполнения
> - Создание, обновление, удаление ресурсов в соответствии с конфигурацией
> - Обновление state

```bash
$ terraform apply <PLAN_FILE>
```
