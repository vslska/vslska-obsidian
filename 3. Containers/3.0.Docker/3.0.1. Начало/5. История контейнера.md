**Контейнеризация** — метод виртуализации в UNIX, при котором ядро ОС поддерживает несколько изолированных пространств пользователя без резервирования ресурсов. Количество пространств при контейнеризации может быть кратно большим, чем при использовании виртуальных машин, но контейнеры в UNIX не изолируются на уровне потребляемых ресурсов. Дальнейшее развитие технологии посвящено улучшению изоляции при сохранении оптимизации ресурсов.
### Команда chroot как решение проблемы изоляции процессов

Историю контейнеризации изменил 1979 год, когда вышла 7-я версия UNIX. Появился системный вызов `chroot`, который заменял корневую директорию процесса и его потомков на ту, что указана в параметрах вызова. Это заложило основу технологии изоляции процессов и разделения доступа к файлам для каждого процесса в UNIX.
![[Pasted image 20251123025437.png]]
`chroot` позволяет пользователю или программе «чувствовать», что они работают в определённой изолированной среде, хотя на самом деле находятся в общей системе.

Но и с `chroot` ОС UNIX имела единое пространство процессов для всех пользователей — ресурсы по-прежнему могло захватить одно приложение, помешав другим.
`chroot` был единственным способом контейнеризации процессов почти 20 лет, пока в 2000 году не появился Jail.
### Механизм виртуализации FreeBSD Jail
![[Pasted image 20251123030254.png]]

**FreeBSD Jail** — механизм виртуализации на уровне операционной системы. Jail позволяет запускать на одной физической машине FreeBSD несколько виртуальных экземпляров операционной системы, использующих общее ядро хостовой системы, но с уникальным набором приложений и настроек. Процессы внутри такой виртуальной среды имеют доступ только к локальным файлам, процессам и учётным записям пользователя, не затрагивая остальные части системы.
**Jail** изолирует процессы и сетевые сервисы, создавая нечто вроде «тюрем» для каждого из них. Каждая «тюрьма» действует как отдельный виртуальный сервер со своим файловым пространством, пользовательскими идентификаторами и сетевыми адресами, но работают на одном ядре.

> [!NOTE] Ещё...
> **Jail** — это тот же `chroot` с возможностью изоляции сети, однако ограничения ресурсов в нём по-прежнему не было до появления [rctl в FreeBSD 9](https://www.freebsd.org/releases/9.0R/relnotes/).

### Появление аналога Jail на Linux
**FreeBSD Jail** считалась наиболее современной системой контейнеризации на базе UNIX, пока в 2001 году не появился её аналог для Linux — **Linux-VServer**.
![[Pasted image 20251123030819.png]]
Каждая изолированная копия системы в терминологии Linux-VServer называлась **контекстом безопасности**, а работающая в нём система — **VPS**.

> [!NOTE] Ещё..
> Работу VPS обеспечивала утилита, подобная `chroot`.

Построенные на основе Linux-VServer виртуальные серверы могли использовать общую файловую систему и общие наборы файлов с помощью жёстких ссылок, что экономило дисковое пространство.

Процессы на виртуальном сервере выполнялись как обычные процессы в хост-системе. Это более эффективно с точки зрения использования памяти и операций ввода-вывода, чем эмуляция всей ОС.

В отличие от полной виртуализации, которая эмулирует виртуальные машины целиком с их собственными ядрами, Linux-VServer делится одним ядром между всеми виртуальными серверами или контейнерами.
### Контейнеры от Google

В 2006 году компания Google разработала систему разделения ресурсов **Process Containers**. Позже она была переименована в **control groups** (cgroups), а затем её включили в ядро Linux. Также они использовали механизм namespaces.
![[Pasted image 20251123031213.png]]
## LXC и Warden

Спустя год выпустили Linux Containers (LXC) — у него было много общего с OpenVZ и Linux-VServer, но вместо сторонних механизмов из патчей ядра использовались стандартные для Linux механизмы namespaces и cgroups.

В 2013 году компания Cloud Foundry создала Warden. Новая утилита предназначалась для запуска приложений, которые получают все свои зависимости от частей ПО, называемых `buildpacks`. Контейнеры Warden обычно имеют два слоя: слой только для чтения с корневой файловой системой ОС и неперсистентный слой чтения/записи самого приложения и его зависимостей. В 2013 году на рынке появился и Docker.
## Docker

Docker придумали в инкубаторе стартапов Y Combinator и выпустили 2011 году программисты Камель Фунади, Соломон Хайкс и Себастьян Пал. Docker использовал LXC как бэкенд для управления контейнерами, но добавил уровень абстракции и упростил процесс создания и управления контейнерами.

Удобство и эффективность Docker помогли контейнеризации завоевать широкую аудиторию и сделали его стандартом среди разработчиков и системных администраторов. Контрибьюторы Docker — Cisco, Google, Huawei, IBM, Microsoft и Red Hat.

### Что важно запомнить? 
- Виртуализация — решение проблемы недоутилизации ресурсов и слабой их изоляции между пользователями.
- Виртуализацию предложила компания IBM в 1960-х, чтобы облегчить одновременную работу множества пользователей на одной машине.
- сhroot в UNIX — технология 1979 года, позволяющая изолировать процессы для повышения безопасности и упрощения тестирования.
- FreeBSD Jail — механизм сhroot, создающий изолированные среды для процессов и сетей внутри одной системы.
- Linux-VServer и аналоги — позволили улучшить изоляцию и использовать ядро Linux для виртуальных серверов.
- сgroups от Google — механизм детализированного управления ресурсами, который лёг в основу современных контейнеров.
- LXC и Warden — инструменты с применением cgroups, пользовавшиеся популярностью до появления Docker.
- Docker — доминирующая технология в мире контейнеризации и DevOps.