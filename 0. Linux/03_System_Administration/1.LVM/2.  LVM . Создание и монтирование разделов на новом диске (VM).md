
> [!NOTE] Предполагается:
>  - Добавлен новый виртуальный диск (например, `/dev/sdb`)
> - Работаем с `root` или через `sudo`
> - Используем **Physical Volume → Volume Group → Logical Volume → FS → mount**. Подробнее о [[1. LVM ]]
> - Не используется шифрование (LUKS) и не требуется загрузочный раздел



## Step 0: Подготовка и проверка
```bash
lsblk
# → Убеждаемся, что новый диск (например, /dev/sdb) виден и НЕ имеет разделов

sudo fdisk -l /dev/sdb
# → Иногда диск имеет старую таблицу — очищаем при необходимости:

sudo wipefs -a /dev/sdb
# ИЛИ (осторожно!) низкоуровнево:
# sudo dd if=/dev/zero of=/dev/sdb bs=1M count=10
```
## Step 1: PV (Physical Volume) 
```bash
sudo pvcreate /dev/sdb
sudo pvs  # проверка
# Или подробнее:
sudo pvdisplay /dev/sdb
```
	PV — «сырой» диск, готовый отдавать пространство LVM.

## Step 2: VG (Volume Group)
```bash
sudo vgcreate vg_data /dev/sdb
sudo vgs
# → vg_data создан
```
Можно добавить **несколько дисков:**
```bash
sudo vgcreate vg_main /dev/sdb /dev/sdc
```

## Step 3: LV (Logical Volume)
Создаём, например, **два тома:**
- `lv_home` — 20 ГБ
- `lv_media` — остаток
```bash
sudo lvcreate -L 20G -n lv_home vg_data
sudo lvcreate -l 100%FREE -n lv_media vg_data
sudo lvs
```
	Опции:
	-L 20G` — фиксированный размер
	-l 100%FREE` — всё оставшееся пространство
	-l +50%FREE` — половина свободного
	-n имя` — имя LV

## Step 4: Файловая система и монтирование
 Форматируем (например, ext4 или xfs — выбирай по вкусу)
```
sudo mkfs.ext4 /dev/vg_data/lv_home
sudo mkfs.xfs /dev/vg_data/lv_media
```
	`xfs` — быстрее для больших файлов и медиа, `ext4` — надёжнее и проще в дебаге.
Создаём точки монтирования
```bash
sudo mkdir -p /mnt/{home,media}
```
##### Монтируем временно
```bash
sudo mount /dev/vg_data/lv_home /mnt/home
sudo mount /dev/vg_data/lv_media /mnt/media
df -h
```

##### Постоянное монтирование (`/etc/fstab`)
```bash
# Получим UUID тома (надёжнее, чем /dev/mapper/...)
sudo blkid /dev/vg_data/lv_home
sudo blkid /dev/vg_data/lv_media
```

Добавим в `/etc/fstab`:
```
UUID=xxxx-xxxx-xxxx /mnt/home ext4 defaults,noatime 0 2
UUID=yyyy-yyyy-yyyy /mnt/media xfs  defaults,noatime 0 2
```

Поверим:
```bash
sudo mount -a
mount | grep mnt
```

## Полезные команды в будущем

|                               |                                                                                    |
| ----------------------------- | ---------------------------------------------------------------------------------- |
| Расширить LV (на 10G)         | `sudo lvextend -L+10G /dev/vg_data/lv_home && sudo resize2fs /dev/vg_data/lv_home` |
| Расширить LV на всё свободное | `sudo lvextend -l+100%FREE /dev/vg_data/lv_media && sudo xfs_growfs /mnt/media`    |
| Добавить диск в VG            | `sudo pvcreate /dev/sdc && sudo vgextend vg_data /dev/sdc`                         |
| Просмотр структуры            | `sudo pvs`, `vgs`, `lvs`, `lsblk`, `ls -la /dev/mapper/`                           |
| Удалить всё (осторожно!)      | `vgremove vg_data`, `pvremove /dev/sdb`                                            |